## Test formula in R

df <- design_data

test_function <- function(probs, design_data){
  if (is(probs, "formula")){
    # Check if variables exist in the dataframe
    if (!all(all.vars(probs) %in% names(design_data))) {
      stop("Variables in formula must exist in the dataframe.")
    }
    
    # Evaluate the formula and create the new column
    probs_expr <- as.character(probs)[[2]]
    df <- df %>%
      mutate(probs := !!rlang::parse_expr(probs_expr))
    return(df)
  } else if(is.character(x)) {
    print("whoops")
  } else{
    stop("'probs' must be a formula or character string")
  }
}

test_function(x = ~n_to_sample/npop, df = df)
